<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>problem_formulation</title>
<style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; max-width: 900px; margin: 40px auto; padding: 20px; color: #333; }
        h1, h2, h3, h4 { color: #1f77b4; margin-top: 1.5em; }
        table { border-collapse: collapse; width: 100%; margin: 1em 0; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background-color: #f2f2f2; font-weight: bold; }
        tr:nth-child(even) { background-color: #f9f9f9; }
        code { background-color: #f4f4f4; padding: 2px 6px; border-radius: 3px; font-family: monospace; }
        pre { background-color: #f4f4f4; padding: 12px; border-radius: 5px; overflow-x: auto; }
        img { max-width: 100%; height: auto; margin: 20px 0; border-radius: 5px; }
        blockquote { border-left: 4px solid #1f77b4; margin: 1em 0; padding-left: 1em; color: #555; }
        a { color: #1f77b4; text-decoration: none; }
        a:hover { text-decoration: underline; }
    </style>
</head>
<body>
<p></p>
<p></p>
<h2>1. Scope and Time Horizon</h2>
<p></p>
<p>We solve a <strong>single static LP</strong> over two strike days:</p>
<p></p>
<p>- Monday: <code>2026-02-09</code></p>
<p>- Tuesday: <code>2026-02-10</code></p>
<p></p>
<p>Static means both days are optimized jointly in one model run (not sequentially).</p>
<p></p>
<h2>2. Sets and Indices</h2>
<p></p>
<p>- $I$: demand nodes (SF Census tracts)</p>
<p>- $J$: supply nodes (meal distribution sites)</p>
<p>- $D = \{2026\text{-}02\text{-}09,\ 2026\text{-}02\text{-}10\}$: days</p>
<p>- $M$: meal types (<code>lunch</code>, optionally <code>breakfast</code>)</p>
<p></p>
<h2>3. Inputs (Parameters)</h2>
<p></p>
<p>- $s_{j,d,m}$: meals available at site $j$, day $d$, meal type $m$</p>
<p>- from <code>data/processed/site<em>day</em>supply.csv</code></p>
<p>- $p_i$: child population (<code>age < 18</code>) in tract $i$</p>
<p>- from Census API (ACS most recent 5-year release at runtime)</p>
<p>- current extraction: ACS 2024, SF county tracts</p>
<p>- $r_m$: participation rate for meal type $m$</p>
<p>- $\mathrm{dem}<em>{i,d,m}$: expected demand, typically $p</em>i \cdot r_m$</p>
<p>- current generated input: <code>data/processed/tract<em>day</em>demand.csv</code></p>
<p>- $c_{i,j}$: access/transport cost from tract $i$ to site $j$</p>
<p>- current generated input: <code>data/processed/tract<em>site</em>cost_matrix.csv</code></p>
<p>- metric: haversine straight-line distance in miles ($c<em>{ij} = \mathrm{distance\</em>miles}$)</p>
<p>- $\lambda_m$: unmet-demand penalty weight</p>
<p></p>
<h2>4. Decision Variables</h2>
<p></p>
<p>- $x_{i,j,d,m} \ge 0$: meals of type $m$ allocated from site $j$ to tract $i$ on day $d$</p>
<p>- $u_{i,d,m} \ge 0$: unmet meals of type $m$ in tract $i$ on day $d$</p>
<p></p>
<h2>5. Objective</h2>
<p></p>
<p>Minimize transport burden and unmet demand across both days:</p>
<p></p>
<p>$$</p>
<p>\min \sum<em>{i,j,d,m} c</em>{i,j}\,x<em>{i,j,d,m} \;+\; \sum</em>{i,d,m} \lambda<em>m\,u</em>{i,d,m}</p>
<p>$$</p>
<p></p>
<h2>6. Constraints</h2>
<p></p>
<p>1. Site/day/meal capacity:</p>
<p>- $\sum<em>i x</em>{i,j,d,m} \le s_{j,d,m}$ for all $(j,d,m)$</p>
<p>2. Demand balance:</p>
<p>- $\sum<em>j x</em>{i,j,d,m} + u<em>{i,d,m} = \mathrm{dem}</em>{i,d,m}$ for all $(i,d,m)$</p>
<p>3. Non-negativity:</p>
<p>- $x<em>{i,j,d,m} \ge 0$, $u</em>{i,d,m} \ge 0$</p>
<p>4. Optional policy constraints:</p>
<p>- maximum service radius ($x<em>{i,j,d,m}=0$ if $c</em>{i,j}$ exceeds threshold)</p>
<p>- equity floor by neighborhood</p>
<p></p>
<h2>7. Initial Modeling Choice</h2>
<p></p>
<p>Baseline run:</p>
<p></p>
<p>- include <code>lunch</code> only</p>
<p>- set <code>M = {lunch}</code></p>
<p>- extend to <code>breakfast</code> in sensitivity if needed</p>
<p></p>
<p>This keeps the first solve aligned with the largest available capacity block.</p>
<p></p>
<p>Comparison setup used for status-quo vs optimized site allocations:</p>
<p></p>
<p>- <code>status<em>quo</code> model: $\sum</em>i x<em>{i,j,d} \le s</em>{j,d}$ with fixed listed site-day supply.</p>
<p>- <code>optimal_reallocation</code> model:</p>
<p>- introduces $y_{j,d}$ as optimized site-day meals</p>
<p>- enforces $\sum<em>i x</em>{i,j,d} \le y_{j,d}$</p>
<p>- conserves day-total meals: $\sum<em>j y</em>{j,d} = \sum<em>j s</em>{j,d}$</p>
<p>- cap on per-site reallocation: $y<em>{j,d} \le \alpha \cdot s</em>{j,d}$ with $\alpha = 2.0$ in baseline run</p>
<p>- unmet penalty set to $\lambda = 100$.</p>
<p></p>
<h2>8. Execution Log</h2>
<p></p>
<p>- [x] Fixed planning horizon to Monday/Tuesday (<code>2026-02-09</code>, <code>2026-02-10</code>).</p>
<p>- [x] Built supply input table (<code>data/processed/site<em>day</em>supply.csv</code>).</p>
<p>- [x] Built tract-level <code>p<em>i</code> from Census API (<code>data/processed/tract</em>child_population.csv</code>, ACS 2024, 244 tracts).</p>
<p>- [x] Built tract/day demand scenarios (<code>data/processed/tract<em>day</em>demand.csv</code>, participation rates <code>0.2, 0.3, 0.4</code>).</p>
<p>- [x] Defined <code>c<em>{i,j}</code> matrix (<code>data/processed/tract</em>site<em>cost</em>matrix.csv</code>, 244x40 pairs).</p>
<p>- [x] Solved baseline comparison LP and exported:</p>
<p>- <code>data/processed/allocation<em>comparison</em>summary.csv</code></p>
<p>- <code>data/processed/site<em>day</em>allocation_comparison.csv</code></p>
<p>- <code>outputs/figures/status<em>quo</em>vs<em>optimal</em>allocations.png</code></p>
<p></p>
</body>
</html>